{
	"name": "bike_share query",
	"properties": {
		"content": {
			"query": "-- CREATE TABLE dbo.bikeshare_raw (\n--     Duration INT,\n--     StartDate DATETIME2,\n--     EndDate DATETIME2,\n--     StartStationNumber INT,\n--     StartStation NVARCHAR(255),\n--     EndStationNumber INT,\n--     EndStation NVARCHAR(255),\n--     BikeNumber NVARCHAR(50),\n--     MemberType NVARCHAR(50)\n--     ) \n--     WITH (\n--         DISTRIBUTION = HASH(StartStationNumber),\n--         CLUSTERED COLUMNSTORE INDEX\n-- );\n\n-- SET SHOWPLAN_XML ON;\n\n-- EXPLAIN\nEXPLAIN WITH_RECOMMENDATIONS\nSELECT \n    StartStationNumber,\n    MONTH(StartDate) AS StartMonth,\n    YEAR(StartDate) AS StartYear,\n    COUNT(*) AS movement,\n    AVG(Duration) AS AverageDuration,\n    SUM(Duration) AS TotalDuration\nFROM dbo.bikeshare_raw\nGROUP BY StartStationNumber, MONTH(StartDate), Year(StartDate)\nORDER BY 1, 3, 2\n\n\nCREATE MATERIALIZED VIEW View1 WITH (DISTRIBUTION = HASH([Expr0])) AS \nSELECT \n    [az_dedicated_sql_pool_for_milgard_practice].[dbo].[bikeshare_raw].[StartStationNumber] AS [Expr0], \n    datepart(month,[az_dedicated_sql_pool_for_milgard_practice].[dbo].[bikeshare_raw].[StartDate]) AS [Expr1], \n    datepart(year,[az_dedicated_sql_pool_for_milgard_practice].[dbo].[bikeshare_raw].[StartDate]) AS [Expr2], \n    COUNT(*) AS [Expr3], \n    AVG([az_dedicated_sql_pool_for_milgard_practice].[dbo].[bikeshare_raw].[Duration]) AS [Expr4], \n    SUM([az_dedicated_sql_pool_for_milgard_practice].[dbo].[bikeshare_raw].[Duration]) AS [Expr5], \n    COUNT_BIG([az_dedicated_sql_pool_for_milgard_practice].[dbo].[bikeshare_raw].[Duration]) AS [Expr8] \nFROM [dbo].[bikeshare_raw] \nGROUP BY [az_dedicated_sql_pool_for_milgard_practice].[dbo].[bikeshare_raw].[StartStationNumber], \n    datepart(month,[az_dedicated_sql_pool_for_milgard_practice].[dbo].[bikeshare_raw].[StartDate]), \n    datepart(year,[az_dedicated_sql_pool_for_milgard_practice].[dbo].[bikeshare_raw].[StartDate])\n\nSELECT * FROM sys.dm_pdw_exec_requests\nORDER BY submit_time DESC\n\nSHOW_STATISTICS dbo.bikeshare_raw;\n\nUPDATE STATISTICS dbo.bikeshare_raw WITH FULLSCAN;\n\n\nWITH request_steps AS(\nSELECT request_id, command, total_elapsed_time, operation_type, step_index\nFROM sys.dm_pdw_request_steps\nWHERE request_id IN ('QID595')\n-- ORDER BY request_id, step_index\n)\nSELECT \n    distribution_id, dpsr.total_elapsed_time\n    -- rs.operation_type, rs.total_elapsed_time, dpsr.*\nFROM sys.dm_pdw_sql_requests dpsr\nJOIN request_steps rs\n    ON dpsr.request_id = rs.request_id AND dpsr.step_index = rs.step_index AND rs.total_elapsed_time>150 AND operation_type = 'ShuffleMoveOperation'\nORDER BY rs.step_index\n\n\nDBCC PDW_SHOWSPACEUSED(\"dbo.bikeshare_raw\")\n\n-- GO\n-- WITH qids AS (\n-- SELECT\n--     request_id,\n--     status,\n--     submit_time,\n--     total_elapsed_time,\n--     command\n-- FROM\n--     sys.dm_pdw_exec_requests\n-- WHERE\n--     session_id = SESSION_ID() -- Gets only queries from your current window\n-- )\n\n-- SELECT \n--     request_id,\n--     command\n-- FROM sys.dm_pdw_sql_requests\n-- SELECT\n--     step_index,\n--     operation_type,\n--     total_elapsed_time,\n--     row_count,\n--     command\n-- FROM\n--     sys.dm_pdw_request_steps\n-- WHERE request_id in (SELECT request_id FROM qids)\n-- ORDER BY\n--     total_elapsed_time DESC; -- Sort by the longest step first",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "az_dedicated_sql_pool_for_milgard_practice",
				"poolName": "az_dedicated_sql_pool_for_milgard_practice"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}